services:
  app:
    build: .
    command: bundle exec jekyll serve --host=0.0.0.0 --force_polling --drafts
    volumes:
      - .:/home/deploy/app:delegated
    ports:
      - "4000:4000"

  clean:
    build: .
    command: bundle exec jekyll clean
    volumes:
      - .:/home/deploy/app:delegated

  shell:
    build: .
    command: bash
    volumes:
      - .:/home/deploy/app
      - ~/.ssh:/home/deploy/.ssh:ro
      - ${SSH_AUTH_SOCK:-/dev/null}:/ssh-agent
      - fast_deploy_cache:/home/deploy/release
    environment:
      SSH_AUTH_SOCK: /ssh-agent


volumes:
  fast_deploy_cache:
  ssh_folder: