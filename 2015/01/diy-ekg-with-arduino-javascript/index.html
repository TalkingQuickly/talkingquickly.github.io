<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0d0d0d" media="(prefers-color-scheme: dark)">
    
    <title>DIY EKG Using Arduino and Javascript - talkingquickly</title>
    
    
    <meta name="description" content="Blog by Ben Dixon, Co-founder of Sona, about startups, elixir, AI, climbing and photography">
    
    
    <link rel="stylesheet" type="text/css" href="/assets/css/minimal.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml">
    <link rel="canonical" href="https://www.talkingquickly.co.uk/2015/01/diy-ekg-with-arduino-javascript/">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="layout-wrapper">
        <header class="mobile-header">
            <div class="mobile-header-top">
                <a href="/" class="site-title">talkingquickly</a>
                <a href="/about.html" class="mobile-about-link">About</a>
            </div>
            <p class="mobile-tagline">Ben Dixon is the co-founder & CTO at Sona. Writing about AI, startups, and engineering.</p>
            <div class="mobile-social-links">
                <a href="https://github.com/talkingquickly" target="_blank" title="GitHub">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                </a>
                <a href="https://twitter.com/talkingquickly" target="_blank" title="Twitter">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                    </svg>
                </a>
                <a href="https://www.linkedin.com/in/talkingquickly/" target="_blank" title="LinkedIn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>
                </a>
                <a href="https://bsky.app/profile/talkingquickly.bsky.social" target="_blank" title="Bluesky">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479.815 2.736 3.713 3.66 6.383 3.364.136-.02.275-.039.415-.056-.138.022-.276.04-.415.056-3.912.58-7.387 2.005-2.83 7.078 5.013 5.19 6.87-1.113 7.823-4.308.953 3.195 2.05 9.271 7.733 4.308 4.267-4.308 1.172-6.498-2.74-7.078a8.741 8.741 0 0 1-.415-.056c.14.017.279.036.415.056 2.67.297 5.568-.628 6.383-3.364.246-.828.624-5.79.624-6.478 0-.69-.139-1.861-.902-2.206-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8Z"/>
                    </svg>
                </a>
            </div>
        </header>
        
        <aside class="sidebar">
            <div class="sidebar-content">
                <div class="sidebar-header">
                    <a href="/" class="site-title">talkingquickly</a>
                    <p class="sidebar-tagline">Ben Dixon is the co-founder & CTO at Sona. Writing about AI, startups, and engineering.</p>
                </div>
                
                <nav class="nav-links">
                    <a href="/about.html">About</a>
                </nav>
                
                <div class="social-links">
                    <a href="https://github.com/talkingquickly" target="_blank" title="GitHub">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                    </a>
                    <a href="https://twitter.com/talkingquickly" target="_blank" title="Twitter">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                        </svg>
                    </a>
                    <a href="https://www.linkedin.com/in/talkingquickly/" target="_blank" title="LinkedIn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                    </a>
                    <a href="https://bsky.app/profile/talkingquickly.co.uk" target="_blank" title="Bluesky">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479.815 2.736 3.713 3.66 6.383 3.364.136-.02.275-.039.415-.056-.138.022-.276.04-.415.056-3.912.58-7.387 2.005-2.83 7.078 5.013 5.19 6.87-1.113 7.823-4.308.953 3.195 2.05 9.271 7.733 4.308 4.267-4.308 1.172-6.498-2.74-7.078a8.741 8.741 0 0 1-.415-.056c.14.017.279.036.415.056 2.67.297 5.568-.628 6.383-3.364.246-.828.624-5.79.624-6.478 0-.69-.139-1.861-.902-2.206-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8Z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </aside>
        
        <div class="main-container">
            <main class="site-content">
                <article class="post">
    <header class="post-header">
        <h1>DIY EKG Using Arduino and Javascript</h1>
    </header>
    
    <div class="post-content">
        <p>An EKG (electrocardiogram) - also referred to as an ECG - is a recording of the electrical activity of the heart. This can be used for measuring the rate and regularity of heart beats. Using a readily available Arduino shield, an Arduino and a $10 set of electrodes, it’s possible to generate this waveform at home and then manipulate and plot it in realtime using Javascript.</p>

<!--more-->

<p>First the obligatory disclaimer. Nothing here is suitable for medical use. The EKG shield being used has not been certified for medical use and I have no medical training at all. Attaching electrodes to yourself could result in electric shock or seizure, continue at your own risk!</p>

<p>Now the fun part. The parts used here are:</p>

<ul>
  <li>An Olimex EKG Shield <a href="https://www.olimex.com/Products/Duino/Shields/SHIELD-EKG-EMG/">https://www.olimex.com/Products/Duino/Shields/SHIELD-EKG-EMG/</a> which can be ordered directly through them and is often also available on Ebay and Amazon.</li>
  <li>A set of three electrodes designed for this board <a href="https://www.olimex.com/Products/Duino/Shields/SHIELD-EKG-EMG-PA/open-source-hardware">https://www.olimex.com/Products/Duino/Shields/SHIELD-EKG-EMG-PA/open-source-hardware</a> again, also available on Ebay and Amazon.</li>
  <li>A standard Arduino Uno <a href="http://arduino.cc/en/Main/arduinoBoardUno">http://arduino.cc/en/Main/arduinoBoardUno</a>.</li>
</ul>

<p>This was built on OSX but it uses a Google Chrome App to interface with the Arduino so should work on any platform which supports these. That should include both Linux and Windows but I haven’t tested the code on either.</p>

<p>The manual for the Olimex board is excellent and <a href="https://www.olimex.com/Products/Duino/Shields/SHIELD-EKG-EMG/resources/SHIELD-EKG-EMG.pdf">available here</a>. It covers the jumper configurations required for basic use, the configuration I used can be seen below.</p>

<p><img src="/assets/images/diy-ekg-arduino/board-configuration.jpg" alt="Jumper Configuration" /></p>

<p>The Arduino sketch they provide is responsible for reading from the analogue inputs associated with the shield and then writing this data out to the Serial port. It’s worth noting two things about the sketch:</p>

<ul>
  <li>The serial port is set to 57600bps not the usual 9600</li>
  <li>The data is written in binary format rather than text so cannot be viewed using the standard Arduino Serial monitor</li>
</ul>

<p>The viewing software they provide is windows only and my end goal wasn’t just to stream the data, it was to automate acquiring and analysing it. This meant writing my own.</p>

<p>My favourite tool at the moment for working with an Arduino is a <a href="https://developer.chrome.com/apps/about_apps">Chrome App</a> these allow native-like apps to be created using standard html and javascript. These apps can do far more than a standard web page, including <a href="https://developer.chrome.com/apps/serial">accessing serial devices</a>.</p>

<p>The source code for my simple  chrome app which reads in data from the Arduino and charts it in realtime is available here <a href="https://github.com/TalkingQuickly/ekg-arduino-chrome">https://github.com/TalkingQuickly/ekg-arduino-chrome</a>.</p>

<p>This provides output which looks like this:</p>

<iframe width="560" height="315" src="//www.youtube.com/embed/Jv4F7q6xR8o" frameborder="0" allowfullscreen=""></iframe>

<p>To install the app in Chrome, clone the repository and then see the “Load the extension” section section of <a href="https://developer.chrome.com/extensions/getstarted">this page</a>.</p>

<p>Next install the sketch available here <a href="https://github.com/TalkingQuickly/ekg-arduino-chrome-sketches">https://github.com/TalkingQuickly/ekg-arduino-chrome-sketches</a> to the Arduino.</p>

<p>The Arduino sketch sends packets of data as a stream of bytes in the following format:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  uint8_t sync0;    // = 0xa5
  uint8_t sync1;    // = 0x5a
  uint8_t version;  // = 2 (packet version)
  uint8_t count;    // packet counter. Increases by 1 each packet.
  uint16_t  data[6];  // 10-bit sample (= 0 - 1023) in big endian (Motorola) format.
  uint8_t switches; // State of PD5 to PD2, in bits 3 to 0.
};
</code></pre></div></div>

<p>This means 17 bytes in total, with the first two being 165,90 and the last being a 1. The Chrome App is responsible for breaking the incoming stream of bytes into valid packets.</p>

<p>Each of the analogue readings within a packet are stored as unsigned 16bit integers meaning they need to be reconstructed from the pairs of bytes received.</p>

<p>This function (found on <a href="http://stackoverflow.com/questions/8482309/converting-javascript-integer-to-byte-array-and-back">Stack Overflow</a> can be used to do this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>byteArrayToLong = function(/*byte[]*/byteArray) {
    var value = 0;
    for ( var i = byteArray.length - 1; i &gt;= 0; i--) {
        value = (value * 256) + byteArray[i];
    }

    return value;
};
</code></pre></div></div>

<p>We can see from the comments in the Arduino sketch that these are sent in the form high byte, low byte:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TXBuf[4] = 0x02;    //CH1 High Byte
TXBuf[5] = 0x00;    //CH1 Low Byte
TXBuf[6] = 0x02;    //CH2 High Byte
TXBuf[7] = 0x00;    //CH2 Low Byte
TXBuf[8] = 0x02;    //CH3 High Byte
TXBuf[9] = 0x00;    //CH3 Low Byte
TXBuf[10] = 0x02;   //CH4 High Byte
TXBuf[11] = 0x00;   //CH4 Low Byte
TXBuf[12] = 0x02;   //CH5 High Byte
TXBuf[13] = 0x00;   //CH5 Low Byte
TXBuf[14] = 0x02;   //CH6 High Byte
TXBuf[15] = 0x00;   //CH6 Low Byte
</code></pre></div></div>

<p>Therefore to get the first channel we can simply call <code class="language-plaintext highlighter-rouge">byteArrayToLong([TXBuf[5], TXBuff[4]])</code>, e.g. with the low byte first.</p>

<p>The app then uses <a href="http://canvasjs.com/">CanvasJS</a> to chart the data in realtime. At the moment only one channel is displayed.</p>

<p>Arguably the hardest part of this project was getting adequate contact between the electrodes and the skin. Another warning, connecting electrodes to yourself has the potential to result in electric shock or seizures, continue at your own risk.</p>

<p>The configuration which I’ve had the most success with is the L and R electrodes on the inside of my left and right wrists and the the D electrode on my ankle. I’ve found it’s very important that the ones on the wrist are tight and that a small layer of shower gel helps to maintain a constant connection.</p>

<p><img src="/assets/images/diy-ekg-arduino/complete.jpg" alt="Complete Setup" /></p>

<p>Next steps:</p>

<ul>
  <li>Automatic peak detection</li>
  <li>Heart Rate Calculation</li>
  <li>Heart Rate Variability Calculation</li>
</ul>

<p>This presentation <a href="http://www.slhn.org/docs/pdf/prehosp-drkasarda1.pdf">http://www.slhn.org/docs/pdf/prehosp-drkasarda1.pdf</a> is useful for getting a feel for roughly how an EKG works and what each part of the waveform represents.</p>

    </div>
    
    
        <!-- If we want to display author's name and bio -->

<section class="author">
  <header> <a href="/about.html"> <img class="profile" src="/assets/images/profile4.jpg" alt="Ben Dixon. Without
      Aviators."></a></header>
  <article>
    <!-- Author Name -->
    <h4> Ben Dixon </h4>
    <!-- Author Bio -->
    <p>
      My name's Ben Dixon, I'm the co-founder of <a target="_blank"
        href="https://www.getsona.com?utm_source=benblogabout">Sona</a> where we're building the operating system for
      the worlds deskless workforce.
      I'm an experienced CTO, LLM geek, lover of good coffee and above all, making things.
      Also a regular conference speaker, author and travel
      addict. Chat to me on twitter <a href="http://www.twitter.com/talkingquickly" target="_blank">@talkingquickly</a>
    </p>
  </article>
</section>

    
    
    
    
    
</article>
            </main>
            
            <footer class="site-footer">
                <p>&copy; 2025 <a href="/about.html">Ben Dixon</a> · 
                <a href="https://twitter.com/talkingquickly" target="_blank">Twitter</a> · 
                <a href="https://www.linkedin.com/in/talkingquickly/" target="_blank">LinkedIn</a> · 
                <a href="mailto:ben@talkingquickly.co.uk">Email</a> · 
                <a href="/rss.xml">RSS</a></p>
            </footer>
        </div>
    </div>
    
    <!-- Simple Analytics -->
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-7333902-35']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
</body>
</html>